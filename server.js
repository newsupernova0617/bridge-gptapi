import dotenv from 'dotenv';
import express from 'express';
import OpenAI from "openai";

dotenv.config();
const app = express();
const port = process.env.PORT || 3001;



const client = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY, // .env
});


async function getExternalData() {
  // const response = await fetch("https://api.example.com/data");
  // if (!response.ok) {
  //   throw new Error(`ì™¸ë¶€ API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
  // }
  // const json = await response.json();
  // return json; // JSON ê°ì²´ ë°˜í™˜
  return {
    week: "2025ë…„ 11ì›” 2ì£¼ì°¨",
    top_issues: ["ì¹´ì¹´ì˜¤íŽ˜ì´ í™˜ë¶ˆ", "ê°•ë‚¨ì  ìš´ì˜ì‹œê°„ ë¬¸ì˜"],
    resolved_issues: ["ê²°ì œ ì˜¤ë¥˜"],
    promotion: "ì¹´ì¹´ì˜¤íŽ˜ì´ ê²°ì œ í”„ë¡œëª¨ì…˜",
    event: "ë¸”ëž™í”„ë¼ì´ë°ì´",
    team_fix: "ì•ˆë“œë¡œì´ë“œ íŒ€",
  };
}

// âœ… ë¦¬í¬íŠ¸ ìƒì„± ì—”ë“œí¬ì¸íŠ¸
app.get("/report", async (req, res) => {
  try {
    const input_json = await getExternalData();

    const response = await client.responses.create({
      model: "gpt-5-nano",
      reasoning: { effort: "low" },
      instructions: `
ë„ˆëŠ” ê³ ê°ì„¼í„° ì£¼ê°„ ë¦¬í¬íŠ¸ë¥¼ ìž‘ì„±í•˜ëŠ” ì½˜í…ì¸  ì–´ì‹œìŠ¤í„´íŠ¸ì•¼.  
ìž…ë ¥ìœ¼ë¡œ ì£¼ì–´ì§€ëŠ” JSON ë°ì´í„°ì—ëŠ” ê³ ê° ë¬¸ì˜ í†µê³„ì™€ ì£¼ìš” ì´ìŠˆ ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìžˆì–´.  
ì´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì•„ëž˜ í˜•ì‹ì˜ ìžì—°ìŠ¤ëŸ¬ìš´ ì£¼ê°„ ë¦¬í¬íŠ¸ë¥¼ ìž‘ì„±í•´ì¤˜.
    {}ì•ˆì— ìžˆëŠ” ë§ì€ ë¬´ì‹œí•´ì¤˜ ê·¸ëƒ¥ ë„ˆì—ê²Œ ì£¼ëŠ” ì°¸ê³ ìš© ì´ì •í‘œì•¼

í˜•ì‹:
{ì˜ˆì‹œ1}
10ì›” 3ì£¼ì°¨

{ì¸ì‚¬ë§} ì•ˆë…•í•˜ì„¸ìš”! ë‚™ì—½ì´ ì ˆì •ì„ ì´ë£¨ëŠ” 10ì›” 3ì£¼ì°¨ìž…ë‹ˆë‹¤. ì§€ë‚œ í•œ ì£¼ê°„ ê³ ê°ë“¤ì˜ ì£¼ìš” ë¬¸ì˜ì‚¬í•­ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.

{ê³ ê° ìƒë‹´ ì¸ì‚¬ì´íŠ¸ 3ì¤„}

ì´ë²ˆ ì£¼ì—ëŠ” ìƒˆë¡­ê²Œ ì¶œì‹œëœ 'ê°€ì„ í•œì •íŒ' íŒ¨í‚¤ì§€ì˜ êµ¬ì„±í’ˆ ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€ ë¬¸ì˜ê°€ ê°€ìž¥ ë§Žì•˜ìŠµë‹ˆë‹¤. í˜„ìž¬ ê¸°íš ì˜ë„ì™€ ë§žì§€ ì•Šì•„ ë³€ê²½ì´ ì–´ë µë‹¤ê³  ì•ˆë‚´í•˜ê³  ìžˆìœ¼ë‚˜, ê³ ê°ì˜ ìš”êµ¬ê°€ ì§€ì†ë˜ì–´ ê¸ì •ì ì¸ ê²€í† ê°€ í•„ìš”í•´ ë³´ìž…ë‹ˆë‹¤.

ë”ë¶ˆì–´ ë°°ì†¡ ì§€ì—°ì— ëŒ€í•œ ë¬¸ì˜ê°€ ì „ ì£¼ ëŒ€ë¹„ 2ë°° ì´ìƒ ê¸‰ì¦í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì§€ë‚œì£¼ë¶€í„° ì‹œìž‘ëœ íƒë°°ì‚¬ì˜ íŒŒì—… ì˜ˆê³ ì™€ ë§žë¬¼ë¦° í˜„ìƒìœ¼ë¡œ ë³´ì´ë©°, ê³ ê°ë“¤ì—ê²Œ ì •í™•í•œ ì§€ì—° ì˜ˆìƒ ì¼ìžë¥¼ ê³µì§€í•˜ëŠ” ê²ƒì´ ì‹œê¸‰í•©ë‹ˆë‹¤.

ë§ë¶™ì—¬, ì§€ë‚œë‹¬ë¶€í„° ë¬¸ì œê°€ ë˜ì—ˆë˜ ë¡œê·¸ì¸ ì‹œ 'ë¹„ë°€ë²ˆí˜¸ 5íšŒ ì˜¤ë¥˜' ìž ê¸ˆ í˜„ìƒì´ CS ì±„ë„ë¡œ ì ‘ìˆ˜ëœ ê±´ì´ 0ê±´ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤! ê°œë°œíŒ€ì—ì„œ ì ìš©í•œ 'ìž ê¸ˆ í•´ì œ ê°„ì†Œí™”' íŒ¨ì¹˜ê°€ íš¨ê³¼ë¥¼ ë³¸ ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤.

{ì˜ˆì‹œ2}
11ì›” 4ì£¼ì°¨

{ì¸ì‚¬ë§}

ì•ˆë…•í•˜ì„¸ìš”! ìŒ€ìŒ€í•œ ë‚ ì”¨ê°€ ì˜·ê¹ƒì„ ì—¬ë¯¸ê²Œ í•˜ëŠ” 11ì›” 4ì£¼ì°¨ìž…ë‹ˆë‹¤. ê³ ê°ë“¤ì˜ ëª©ì†Œë¦¬ë¥¼ í†µí•´ ì´ë²ˆ ì£¼ì˜ ì£¼ìš” ì´ìŠˆë¥¼ íŒŒì•…í•´ ë´…ì‹œë‹¤.

{ê³ ê° ìƒë‹´ ì¸ì‚¬ì´íŠ¸ 3ì¤„}

ì´ë²ˆ ì£¼ì—ëŠ” 'ì¹œêµ¬ ì¶”ì²œ' ì´ë²¤íŠ¸ ë³´ìƒ ì§€ê¸‰ ëˆ„ë½ì— ëŒ€í•œ ë¬¸ì˜ê°€ ë‹¤ìˆ˜ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ í™•ì¸í•œ ê²°ê³¼, íŠ¹ì • OS í™˜ê²½ì—ì„œ ì¶”ì²œ ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì§€ ì•ŠëŠ” ë²„ê·¸ë¡œ í™•ì¸ë˜ì–´ ë¹ ë¥¸ ì‹œì¼ ë‚´ ìˆ˜ì • ë° ì¼ê´„ ì§€ê¸‰ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë”ë¶ˆì–´ ì˜¤í”„ë¼ì¸ ë§¤ìž¥ì—ì„œ ê¸°íšìƒí’ˆ íŒë§¤ ìš”ì²­ì´ ëˆˆì— ë„ê²Œ ëŠ˜ì—ˆìŠµë‹ˆë‹¤. ì—°ë§ ì‹œì¦Œì„ ì•žë‘ê³  ìžˆì–´ ê³ ê°ë“¤ì´ ë” ë‹¤ì–‘í•œ ìƒí’ˆì„ ê³ ê°ë“¤ì´ ì‹¤ì²´ë¡œ ì²´í—˜í•˜ê³  êµ¬ë§¤í•˜ê¸°ë¥¼ ì›í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤.

ë§ë¶™ì—¬, ê³ ê°ì´ ì§ì ‘ ì£¼ë¬¸ ë‚´ì—­ì—ì„œ ë°°ì†¡ì§€ ì£¼ì†Œë¥¼ ë³€ê²½í•  ìˆ˜ ìžˆê²Œ ê°œì„ ëœ ì´í›„, 'ë°°ì†¡ì§€ ë³€ê²½ ìš”ì²­' ê´€ë ¨ CS ì ‘ìˆ˜ ê±´ìˆ˜ê°€ 90% ì´ìƒ ê°ì†Œí•˜ëŠ” ê¸ì •ì ì¸ íš¨ê³¼ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤!

{ì˜ˆì‹œ3}
12ì›” 1ì£¼ì°¨

{ì¸ì‚¬ë§} ì•ˆë…•í•˜ì„¸ìš”! í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë¶„ìœ„ê¸°ê°€ ë¬¼ì”¬ ëŠê»´ì§€ëŠ” 12ì›”ì˜ ì²«ì§¸ ì£¼ìž…ë‹ˆë‹¤. ì§€ë‚œ í•œ ì£¼ê°„ ê³ ê°ì„¼í„°ë¡œ ì ‘ìˆ˜ëœ ì£¼ìš” ì´ìŠˆë“¤ì„ ê³µìœ í•©ë‹ˆë‹¤.

{ê³ ê° ìƒë‹´ ì¸ì‚¬ì´íŠ¸ 3ì¤„}

ì´ë²ˆ ì£¼ì—ëŠ” í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í•œì • ìƒí’ˆ í’ˆì ˆ ì‹œì ì— ëŒ€í•œ ë¬¸ì˜ì™€ ë¶ˆë§Œì´ í­ë°œì ìœ¼ë¡œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤. ì¤€ë¹„ëœ ìˆ˜ëŸ‰ì´ ì˜ˆìƒë³´ë‹¤ ë¹¨ë¦¬ ì†Œì§„ë˜ì–´, ê³ ê°ë“¤ì€ ìž¬ìž…ê³  ì¼ì • ë° ì˜ˆì•½ êµ¬ë§¤ ê°€ëŠ¥ ì—¬ë¶€ì— ëŒ€í•œ ëª…í™•í•œ ë‹µë³€ì„ ê°•ë ¥í•˜ê²Œ ìš”êµ¬í•˜ê³  ìžˆìŠµë‹ˆë‹¤.

ë”ë¶ˆì–´ ì‹ ê·œ ê²°ì œ ìˆ˜ë‹¨ì¸ ë„¤ì´ë²„íŽ˜ì´ ì´ìš© ì‹œ í• ì¸ì¿ í° ë¯¸ì ìš© ì˜¤ë¥˜ ë¬¸ì˜ê°€ ì§‘ì¤‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ì—°ë™ ë¬¸ì œë¡œ ë³´ì´ë©°, ê³ ê°ì˜ ë¶ˆíŽ¸ í•´ì†Œë¥¼ ìœ„í•´ ê²°ì œíŒ€ì˜ ê¸´ê¸‰ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

ìž…ë ¥ ë°ì´í„° ì˜ˆì‹œ(JSON):
{
  "week": "2025ë…„ 11ì›” 2ì£¼ì°¨",
  "top_issues": ["ì¹´ì¹´ì˜¤íŽ˜ì´ í™˜ë¶ˆ", "ê°•ë‚¨ì  ìš´ì˜ì‹œê°„ ë¬¸ì˜"],
  "resolved_issues": ["ê²°ì œ ì˜¤ë¥˜"],
  "promotion": "ì¹´ì¹´ì˜¤íŽ˜ì´ ê²°ì œ í”„ë¡œëª¨ì…˜",
  "event": "ë¸”ëž™í”„ë¼ì´ë°ì´",
  "team_fix": "ì•ˆë“œë¡œì´ë“œ íŒ€"
}

---

ì‘ë‹µì€ ìœ„ í˜•ì‹ ê·¸ëŒ€ë¡œ ì¶œë ¥í•´ì¤˜.
      `,
      input: `ë‹¤ìŒ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì¤˜:\n\`\`\`json\n${JSON.stringify(input_json, null, 2)}\n\`\`\``,
    });

    res.status(200).send(response.output_text);
  } catch (error) {
    console.error("âŒ ì˜¤ë¥˜ ë°œìƒ:", error);
    res.status(500).send(`ì„œë²„ ì˜¤ë¥˜: ${error.message}`);
  }
});

// âœ… ì„œë²„ ì‹¤í–‰
app.listen(port, () => {
  console.log(`ðŸš€ ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:${port}`);
});







