import express from 'express';
import OpenAI from "openai";
import path from 'path';
import { fileURLToPath } from 'url';


const app = express();
const port = process.env.PORT || 3001;


// __dirname ëŒ€ì²´ (ESMì—ì„œëŠ” ì§ì ‘ ì‚¬ìš© ë¶ˆê°€)
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);



const client = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY, // .env
});



async function getExternalData() {
  // const response = await fetch("https://api.example.com/data");
  // if (!response.ok) {
  //   throw new Error(`ì™¸ë¶€ API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
  // }
  // const json = await response.json();
  // return json; // JSON ê°ì²´ ë°˜í™˜
  return {
    week: "2025ë…„ 11ì›” 2ì£¼ì°¨",
    top_issues: ["ì¹´ì¹´ì˜¤íŽ˜ì´ í™˜ë¶ˆ", "ê°•ë‚¨ì  ìš´ì˜ì‹œê°„ ë¬¸ì˜"],
    resolved_issues: ["ê²°ì œ ì˜¤ë¥˜"],
    promotion: "ì¹´ì¹´ì˜¤íŽ˜ì´ ê²°ì œ í”„ë¡œëª¨ì…˜",
    event: "ë¸”ëž™í”„ë¼ì´ë°ì´",
    team_fix: "ì•ˆë“œë¡œì´ë“œ íŒ€",
  };
}
app.use(express.static(path.join(__dirname, 'public')));

app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

// âœ… ë¦¬í¬íŠ¸ ìƒì„± ì—”ë“œí¬ì¸íŠ¸
app.get("/report", async (req, res) => {
  try {
    const input_json = await getExternalData();

    const response = await client.responses.create({
      model: "gpt-5-mini",
      reasoning: { effort: "high" },
      instructions: `
### role ###

ë„ˆëŠ” 10ë…„ì°¨ CXíŒ€ ë¦¬ë”ì•¼. 8ì£¼ê°„ì˜ ìƒë‹´íƒœê·¸ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  íƒœê·¸ë³„ ì¦ê° ì¶”ì´ë¥¼ í™•ì¸í•´ì„œ ì¸ì‚¬ì´íŠ¸ë¥¼ ë½‘ì•„ì•¼ í•´.

ì¸ì‚¬ì´íŠ¸ëŠ” ì•„ëž˜ì— ì£¼ì–´ì§€ëŠ” dataì™€ ê¸°ì—… íŠ¹ì´ì‚¬í•­ì„ ë°˜ì˜í•´ì„œ ì¸ì‚¬ì´íŠ¸ë¥¼ ë½‘ì•„ì¤˜.

1. ì´ì „ 4ì£¼ì™€ ë¹„êµí•´ ê³¼í•˜ê²Œ ì¦ê°€/ê°ì†Œí•œ íƒœê·¸

1-1. ì¦ê°í•œ ì´ìœ ë¥¼ ê¸°ì—… íŠ¹ì´ì‚¬í•­ì—ì„œ ì°¾ì•„ì•¼ í•´

1-2. ì¦ê°í•œ ë¹„ìœ¨ì„ ëª…í™•í•˜ê²Œ ì–¸ê¸‰í•´ì•¼í•´. (ex: ì „ì£¼ ëŒ€ë¹„ 50% ê°ì†Œ)

2. ê¸°ì—… íŠ¹ì´ì‚¬í•­ì— ì–¸ê¸‰ëœ íƒœê·¸

2-1.ê¸°ì—… íŠ¹ì´ì‚¬í•­ì—ì„œ ì–¸ê¸‰ëœ ì˜ˆìƒì¹˜ì— ë¹„í•´ ë§Žì´ ë²—ì–´ë‚˜ëŠ” ê²½ìš° ì¸ì‚¬ì´íŠ¸ë¡œ ì„¤ëª… (ex: ë¸”ëž™í”„ë¼ì´ë°ì´ ì„¸ì¼ë¡œ ì¸í•´ 100ê±´ ì •ë„ ë“¤ì–´ì˜¬ ê²ƒìœ¼ë¡œ ì˜ˆìƒí•œ í™˜ë¶ˆë¬¸ì˜ê°€ 4ê±´ë§Œ ë“¤ì–´ì™€ì„œ ì´ë¡€ì ì¸ ìˆ˜ì¹˜ì´ë‹¤)

3. ì¸ì‚¬ì´íŠ¸ëŠ” í•œêµ­ì–´ë¥¼ ë””í´íŠ¸ë¡œ í•˜ê³  ì˜ì–´ì™€ ì¼ë³¸ì–´ëŠ” í•œêµ­ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë²ˆì—­í•´ì„œ ë½‘ì•„ì¤˜

4. ì¶œë ¥í˜•ì‹ì€ jsonìœ¼ë¡œ ,í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ì–´ì¤˜
{
"kor":"{í•œêµ­ì–´ ì¸ì‚¬ì´íŠ¸}"
"eng":"{í•œêµ­ì–´ ì¸ì‚¬ì´íŠ¸ì˜ ì˜ì–´ ë²ˆì—­ ë²„ì „}"
"jpn":"{í•œêµ­ì–´ ì¸ì‚¬ì´íŠ¸ì˜ ì¼ë³¸ì–´ ë²ˆì—­ ë²„ì „}"
}

### instruction ###

ìž…ë ¥ìœ¼ë¡œ ì£¼ì–´ì§€ëŠ” JSON ë°ì´í„°ì—ëŠ” ê³ ê° ë¬¸ì˜ í†µê³„ì™€ ì£¼ìš” ì´ìŠˆ ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìžˆì–´.

Dataë¥¼ ë¶„ì„í•˜ê³  exampleë¥¼ ì°¸ê³ í•´.

### output instruction ###

{yearweek}

{ì¸ì‚¬ë§}

{ê³ ê° ìƒë‹´ ì¸ì‚¬ì´íŠ¸ 3ì¤„}

### output example ###

{}ì•ˆì— ìžˆëŠ” ë§ì€ ë¬´ì‹œí•´ì¤˜ ê·¸ëƒ¥ ë„ˆì—ê²Œ ì£¼ëŠ” ì°¸ê³ ìš© ì´ì •í‘œì•¼

í˜•ì‹:

#example_1

Yearweek:10ì›” 3ì£¼ì°¨

{ì¸ì‚¬ë§} ì•ˆë…•í•˜ì„¸ìš”! ë‚™ì—½ì´ ì ˆì •ì„ ì´ë£¨ëŠ” 10ì›” 3ì£¼ì°¨ìž…ë‹ˆë‹¤. ì§€ë‚œ í•œ ì£¼ê°„ ê³ ê°ë“¤ì˜ ì£¼ìš” ë¬¸ì˜ì‚¬í•­ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.

{ê³ ê° ìƒë‹´ ì¸ì‚¬ì´íŠ¸ 3ì¤„}

ì´ë²ˆ ì£¼ì—ëŠ” ìƒˆë¡­ê²Œ ì¶œì‹œëœ 'ê°€ì„ í•œì •íŒ' íŒ¨í‚¤ì§€ì˜ êµ¬ì„±í’ˆ ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€ ë¬¸ì˜ê°€ ê°€ìž¥ ë§Žì•˜ìŠµë‹ˆë‹¤. í˜„ìž¬ ê¸°íš ì˜ë„ì™€ ë§žì§€ ì•Šì•„ ë³€ê²½ì´ ì–´ë µë‹¤ê³  ì•ˆë‚´í•˜ê³  ìžˆìœ¼ë‚˜, ê³ ê°ì˜ ìš”êµ¬ê°€ ì§€ì†ë˜ì–´ ê¸ì •ì ì¸ ê²€í† ê°€ í•„ìš”í•´ ë³´ìž…ë‹ˆë‹¤.

ë”ë¶ˆì–´ ë°°ì†¡ ì§€ì—°ì— ëŒ€í•œ ë¬¸ì˜ê°€ ì „ ì£¼ ëŒ€ë¹„ 2ë°° ì´ìƒ ê¸‰ì¦í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì§€ë‚œì£¼ë¶€í„° ì‹œìž‘ëœ íƒë°°ì‚¬ì˜ íŒŒì—… ì˜ˆê³ ì™€ ë§žë¬¼ë¦° í˜„ìƒìœ¼ë¡œ ë³´ì´ë©°, ê³ ê°ë“¤ì—ê²Œ ì •í™•í•œ ì§€ì—° ì˜ˆìƒ ì¼ìžë¥¼ ê³µì§€í•˜ëŠ” ê²ƒì´ ì‹œê¸‰í•©ë‹ˆë‹¤.

ë§ë¶™ì—¬, ì§€ë‚œë‹¬ë¶€í„° ë¬¸ì œê°€ ë˜ì—ˆë˜ ë¡œê·¸ì¸ ì‹œ 'ë¹„ë°€ë²ˆí˜¸ 5íšŒ ì˜¤ë¥˜' ìž ê¸ˆ í˜„ìƒì´ CS ì±„ë„ë¡œ ì ‘ìˆ˜ëœ ê±´ì´ 0ê±´ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤! ê°œë°œíŒ€ì—ì„œ ì ìš©í•œ 'ìž ê¸ˆ í•´ì œ ê°„ì†Œí™”' íŒ¨ì¹˜ê°€ íš¨ê³¼ë¥¼ ë³¸ ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤.

#example_2

Yearweek: 11ì›” 4ì£¼ì°¨

{ì¸ì‚¬ë§}

ì•ˆë…•í•˜ì„¸ìš”! ìŒ€ìŒ€í•œ ë‚ ì”¨ê°€ ì˜·ê¹ƒì„ ì—¬ë¯¸ê²Œ í•˜ëŠ” 11ì›” 4ì£¼ì°¨ìž…ë‹ˆë‹¤. ê³ ê°ë“¤ì˜ ëª©ì†Œë¦¬ë¥¼ í†µí•´ ì´ë²ˆ ì£¼ì˜ ì£¼ìš” ì´ìŠˆë¥¼ íŒŒì•…í•´ ë´…ì‹œë‹¤.

{ê³ ê° ìƒë‹´ ì¸ì‚¬ì´íŠ¸ 3ì¤„}

ì´ë²ˆ ì£¼ì—ëŠ” 'ì¹œêµ¬ ì¶”ì²œ' ì´ë²¤íŠ¸ ë³´ìƒ ì§€ê¸‰ ëˆ„ë½ì— ëŒ€í•œ ë¬¸ì˜ê°€ ë‹¤ìˆ˜ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ í™•ì¸í•œ ê²°ê³¼, íŠ¹ì • OS í™˜ê²½ì—ì„œ ì¶”ì²œ ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì§€ ì•ŠëŠ” ë²„ê·¸ë¡œ í™•ì¸ë˜ì–´ ë¹ ë¥¸ ì‹œì¼ ë‚´ ìˆ˜ì • ë° ì¼ê´„ ì§€ê¸‰ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë”ë¶ˆì–´ ì˜¤í”„ë¼ì¸ ë§¤ìž¥ì—ì„œ ê¸°íšìƒí’ˆ íŒë§¤ ìš”ì²­ì´ ëˆˆì— ë„ê²Œ ëŠ˜ì—ˆìŠµë‹ˆë‹¤. ì—°ë§ ì‹œì¦Œì„ ì•žë‘ê³  ìžˆì–´ ê³ ê°ë“¤ì´ ë” ë‹¤ì–‘í•œ ìƒí’ˆì„ ê³ ê°ë“¤ì´ ì‹¤ì²´ë¡œ ì²´í—˜í•˜ê³  êµ¬ë§¤í•˜ê¸°ë¥¼ ì›í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤.

ë§ë¶™ì—¬, ê³ ê°ì´ ì§ì ‘ ì£¼ë¬¸ ë‚´ì—­ì—ì„œ ë°°ì†¡ì§€ ì£¼ì†Œë¥¼ ë³€ê²½í•  ìˆ˜ ìžˆê²Œ ê°œì„ ëœ ì´í›„, 'ë°°ì†¡ì§€ ë³€ê²½ ìš”ì²­' ê´€ë ¨ CS ì ‘ìˆ˜ ê±´ìˆ˜ê°€ 90% ì´ìƒ ê°ì†Œí•˜ëŠ” ê¸ì •ì ì¸ íš¨ê³¼ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤!

#example_3

yearweek: 12ì›” 1ì£¼ì°¨

{ì¸ì‚¬ë§} ì•ˆë…•í•˜ì„¸ìš”! í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë¶„ìœ„ê¸°ê°€ ë¬¼ì”¬ ëŠê»´ì§€ëŠ” 12ì›”ì˜ ì²«ì§¸ ì£¼ìž…ë‹ˆë‹¤. ì§€ë‚œ í•œ ì£¼ê°„ ê³ ê°ì„¼í„°ë¡œ ì ‘ìˆ˜ëœ ì£¼ìš” ì´ìŠˆë“¤ì„ ê³µìœ í•©ë‹ˆë‹¤.

{ê³ ê° ìƒë‹´ ì¸ì‚¬ì´íŠ¸ 3ì¤„}

ì´ë²ˆ ì£¼ì—ëŠ” í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í•œì • ìƒí’ˆ í’ˆì ˆ ì‹œì ì— ëŒ€í•œ ë¬¸ì˜ì™€ ë¶ˆë§Œì´ í­ë°œì ìœ¼ë¡œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤. ì¤€ë¹„ëœ ìˆ˜ëŸ‰ì´ ì˜ˆìƒë³´ë‹¤ ë¹¨ë¦¬ ì†Œì§„ë˜ì–´, ê³ ê°ë“¤ì€ ìž¬ìž…ê³  ì¼ì • ë° ì˜ˆì•½ êµ¬ë§¤ ê°€ëŠ¥ ì—¬ë¶€ì— ëŒ€í•œ ëª…í™•í•œ ë‹µë³€ì„ ê°•ë ¥í•˜ê²Œ ìš”êµ¬í•˜ê³  ìžˆìŠµë‹ˆë‹¤.

ë”ë¶ˆì–´ ì‹ ê·œ ê²°ì œ ìˆ˜ë‹¨ì¸ ë„¤ì´ë²„íŽ˜ì´ ì´ìš© ì‹œ í• ì¸ì¿ í° ë¯¸ì ìš© ì˜¤ë¥˜ ë¬¸ì˜ê°€ ì§‘ì¤‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ì—°ë™ ë¬¸ì œë¡œ ë³´ì´ë©°, ê³ ê°ì˜ ë¶ˆíŽ¸ í•´ì†Œë¥¼ ìœ„í•´ ê²°ì œíŒ€ì˜ ê¸´ê¸‰ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤.
      `,
      input: `ë‹¤ìŒ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì¤˜:\n\`\`\`json\n${JSON.stringify(input_json, null, 2)}\n\`\`\``,
    });

    res.status(200).send(response.output_text);
  } catch (error) {
    console.error("âŒ ì˜¤ë¥˜ ë°œìƒ:", error);
    res.status(500).send(`ì„œë²„ ì˜¤ë¥˜: ${error.message}`);
  }
});

// âœ… ì„œë²„ ì‹¤í–‰
app.listen(port, () => {
  console.log(`ðŸš€ ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:${port}`);
});







